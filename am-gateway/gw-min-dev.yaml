# gateway/gw-min.yaml
wso2:
  deployment:
    replicas: 1
    image:
      registry: docker.io
      repository: chiranthajk/wso2am-universal-gw-mysql:4.6.0
      digest: "sha256:24a5095e408c12d44a9b52ad8fbbbec6844b5ef84f1f4c7ff63a81db2266c148"
      imagePullPolicy: Always
  
  # --- 1. THIS IS YOUR BLOCK ---
  # This correctly sets [apim.analytics] enable = true in the deployment.toml
  ELKAnalytics:
    enabled: true
  
  # --- (rest of your apim config) ---
  apim:
    configurations:
      userStore:
        type: "database_unique_id"
      adminUsername: "admin"
      adminPassword: "admin"
      security:
        keystores:
          tls:
            name: "gateway-keystore.jks"
            alias: "wso2carbon"
            password: "wso2carbon"
            keyPassword: "wso2carbon"
        truststore:
          password: "wso2carbon"
      databases:
        type: "h2"
        jdbc:
          driver: "org.h2.Driver"
        shared_db:
          url: "jdbc:h2:./repository/database/WSO2SHARED_DB;DB_CLOSE_ON_EXIT=FALSE"
          username: "wso2carbon"
          password: "wso2carbon"
      km:
        serviceUrl: "acp-wso2am-acp-service.apim-cp.svc.cluster.local"
        servicePort: 9443
      throttling:
        serviceUrl: "acp-wso2am-acp-service.apim-cp.svc.cluster.local"
        servicePort: 9443
        urls:
          - "acp-wso2am-acp-1-service.apim-cp.svc.cluster.local"
          - "acp-wso2am-acp-2-service.apim-cp.svc.cluster.local"
      transport:
        passthru_https:
          sender:
            parameters:
              hostnameVerifier: "AllowAll"

kubernetes:
  ingress:
    gateway:
      hostname: "dev.airbus.gw.wso2.com"
    websub: # <-- NEW BLOCK FOR WEBSUB HOSTNAME
      hostname: "dev.websub.wso2.com"
    websocket: # <-- NEW BLOCK FOR WEBSOCKET HOSTNAME
      hostname: "dev.websocket.wso2.com"