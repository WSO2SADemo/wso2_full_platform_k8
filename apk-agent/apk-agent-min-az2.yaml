# Copyright (c) 2024, WSO2 LLC. (https://www.wso2.com) All Rights Reserved.
#
# WSO2 LLC. licenses this file to you under the Apache License,
# Version 2.0 (the "License"); you may not use this file except
# in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied. See the License for the
# specific language governing permissions and limitations
# under the License.

# Minimal configuration for APK Agent
# Architecture: Control Plane --> APK Agent --> APK Gateway
# Agent acts as middleware between CP and APK Gateway

wso2:
  subscription:
    imagePullSecrets: ""

replicaCount: 1

image:
  repository: wso2/apim-apk-agent
  tag: 1.3.1
  pullPolicy: Always

service:
  name: apim-apk-agent-service

resources:
  requests:
    memory: "128Mi"
    cpu: "100m"
  limits:
    memory: "256Mi"
    cpu: "200m"

# Control Plane connection configuration
# Agent polls CP for API/Application/Subscription changes
controlPlane:
  enabled: true
  # CP REST API endpoint
  serviceURL: https://acp-wso2am-acp-service.apim-cp.svc.cluster.local:9443/
  username: admin
  password: admin
  environmentLabels: APK-GW
  skipSSLVerification: true
  # CP Event Bus (AMQP) for real-time notifications
  eventListeningEndpoints: amqp://admin:admin@acp-wso2am-acp-service.apim-cp.svc.cluster.local:5672?retries='10'&connectdelay='30'
  internalKeyIssuer: http://cp.c2.mbcp-demo.com:443/token

# Data Plane (APK Gateway) connection configuration
# Agent pushes K8s resources to APK Gateway's Config Deployer Service
dataPlane:
  enabled: true
  # APK Gateway Config Deployer Service endpoint
  k8ResourceEndpoint: https://kgw-wso2-apk-config-ds-service.apim-kgw.svc.cluster.local:9443/api/configurator/apis/generate-k8s-resources
  namespace: apim-kgw

metrics:
  enabled: false

# Agent mode: Control Plane to Data Plane
agent:
  mode: CPtoDP

certmanager:
  enabled: false
  enableClusterIssuer: true

# Service Account and RBAC configuration
# Required for Agent to create K8s resources in APK Gateway namespace
serviceAccount:
  enableServiceAccountCreation: true
  enableClusterRoleCreation: true
  serviceAccountName: wso2agent-platform
  roleName: wso2agent-role
