openapi: 3.0.1
info:
  title: OASServiceAPI
  description: |
    Master Database Service for Swedish Unemployment Benefits (A-kassa) System.
    This service manages member benefit registrations from various Cash Registries (A-kassorna)
    and provides lookup capabilities for Arbetsförmedlingen (AF).
  contact:
    name: OAS Service Support
  version: 1.0.0
servers:
 -
  url: http://localhost:9092/oas
  description: Local development server
security:
 -
  default: []
tags:
 -
  name: Benefits
  description: Benefit registration and management
 -
  name: Members
  description: Member lookup and updates
 -
  name: Health
  description: Service health check
paths:
  /benefits:
    post:
      tags:
       - Benefits
      summary: Register or update member benefit data
      description: |
        Called by Cash Registries (A-kassorna) to register or update member benefit information
        in the OAS master database.
      operationId: registerBenefit
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BenefitRegistrationRequest"
            examples:
              highIncomeMember:
                summary: High income member registration
                value:
                  personalNumber: "199001011234"
                  kassaName: Unionens A-kassa
                  dailyAllowance: 960
                  incomeBase: HIGH
                  totalDays: 300
              mediumIncomeMember:
                summary: Medium income member registration
                value:
                  personalNumber: "198505152345"
                  kassaName: Akademikernas A-kassa
                  dailyAllowance: 666.67
                  incomeBase: MEDIUM
                  totalDays: 300
        required: true
      responses:
        "200":
          description: Benefit successfully registered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegistrationResponse"
              example:
                success: true
                message: Benefit data successfully registered in OAS
                registrationId: "199001011234"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
      security:
       -
        default:
         - privilaged
      x-auth-type: Application & Application User
      x-throttling-tier: AllowedIPs
      x-wso2-application-security:
        security-types:
         - api_key
         - oauth2
        optional: false
  /members/{personalNumber}:
    get:
      tags:
       - Members
      summary: Lookup member benefit information
      description: |
        Called by Arbetsförmedlingen (AF) to check if a person is registered with an A-kassa
        and retrieve their benefit information.
      operationId: lookupMember
      parameters:
       -
        name: personalNumber
        in: path
        description: Swedish personal number (personnummer)
        required: true
        style: simple
        explode: false
        schema:
          pattern: "^\\d{10,12}$"
          type: string
        example: "199001011234"
      responses:
        "200":
          description: Lookup completed (member may or may not be found)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MemberLookupResponse"
              examples:
                memberFound:
                  summary: Member found in OAS
                  value:
                    found: true
                    benefit:
                      personalNumber: "199001011234"
                      kassaName: Unionens A-kassa
                      isMember: true
                      dailyAllowance: 960
                      incomeBase: HIGH
                      remainingDays: 300
                      registrationDate: 2024-01-15T10:30:00Z
                      lastUpdated: 2024-01-15T10:30:00Z
                memberNotFound:
                  summary: Member not found in OAS
                  value:
                    found: false
                    benefit: null
      security:
       -
        default: []
      x-auth-type: Application & Application User
      x-throttling-tier: Unlimited
      x-wso2-application-security:
        security-types:
         - api_key
         - oauth2
        optional: false
  /members/{personalNumber}/days:
    put:
      tags:
       - Members
      summary: Update remaining benefit days
      description: |
        Called when benefits are consumed to update the remaining days for a member.
      operationId: updateRemainingDays
      parameters:
       -
        name: personalNumber
        in: path
        description: Swedish personal number (personnummer)
        required: true
        style: simple
        explode: false
        schema:
          pattern: "^\\d{10,12}$"
          type: string
        example: "199001011234"
       -
        name: daysUsed
        in: query
        description: Number of benefit days consumed
        required: true
        style: form
        explode: true
        schema:
          minimum: 1
          type: integer
        example: 5
      responses:
        "200":
          description: Days successfully updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegistrationResponse"
              example:
                success: true
                message: "Days updated. Remaining: 295"
        "404":
          description: Member not found in OAS
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegistrationResponse"
              example:
                success: false
                message: Member not found in OAS
      security:
       -
        default: []
      x-auth-type: Application & Application User
      x-throttling-tier: Unlimited
      x-wso2-application-security:
        security-types:
         - api_key
         - oauth2
        optional: false
  /health:
    get:
      tags:
       - Health
      summary: Health check endpoint
      description: Returns the health status of the OAS service
      operationId: healthCheck
      responses:
        "200":
          description: Service is healthy
          content:
            text/plain:
              schema:
                type: string
                example: OAS Service is running
      security:
       -
        default:
         - ordinary
      x-auth-type: Application & Application User
      x-throttling-tier: Unlimited
      x-wso2-application-security:
        security-types:
         - api_key
         - oauth2
        optional: false
components:
  schemas:
    BenefitRegistrationRequest:
      required:
       - dailyAllowance
       - incomeBase
       - kassaName
       - personalNumber
       - totalDays
      type: object
      properties:
        personalNumber:
          pattern: "^\\d{10,12}$"
          type: string
          description: Swedish personal number (personnummer)
          example: "199001011234"
        kassaName:
          type: string
          description: Name of the A-kassa (unemployment insurance fund)
          example: Unionens A-kassa
        dailyAllowance:
          maximum: 1200
          minimum: 0
          type: number
          description: Daily unemployment allowance in SEK
          format: double
          example: 960
        incomeBase:
          type: string
          description: Income base category
          example: HIGH
          enum:
           - HIGH
           - MEDIUM
           - LOW
        totalDays:
          minimum: 1
          type: integer
          description: Total number of benefit days (typically 300)
          example: 300
    RegistrationResponse:
      required:
       - message
       - success
      type: object
      properties:
        success:
          type: boolean
          description: Whether the operation was successful
          example: true
        message:
          type: string
          description: Human-readable message about the operation result
          example: Benefit data successfully registered in OAS
        registrationId:
          type: string
          description: Registration identifier (typically the personal number)
          example: "199001011234"
    MemberLookupResponse:
      required:
       - found
      type: object
      properties:
        found:
          type: boolean
          description: Whether the member was found in OAS
          example: true
        benefit:
          $ref: "#/components/schemas/MemberBenefit"
    MemberBenefit:
      required:
       - dailyAllowance
       - incomeBase
       - isMember
       - kassaName
       - lastUpdated
       - personalNumber
       - registrationDate
       - remainingDays
      type: object
      properties:
        personalNumber:
          pattern: "^\\d{10,12}$"
          type: string
          description: Swedish personal number (personnummer)
          example: "199001011234"
        kassaName:
          type: string
          description: Name of the A-kassa
          example: Unionens A-kassa
        isMember:
          type: boolean
          description: Whether the person is an active member
          example: true
        dailyAllowance:
          type: number
          description: Daily unemployment allowance in SEK
          format: double
          example: 960
        incomeBase:
          type: string
          description: Income base category
          example: HIGH
          enum:
           - HIGH
           - MEDIUM
           - LOW
        remainingDays:
          minimum: 0
          type: integer
          description: Number of benefit days remaining
          example: 300
        registrationDate:
          type: string
          description: ISO 8601 timestamp of initial registration
          format: date-time
          example: 2024-01-15T10:30:00Z
        lastUpdated:
          type: string
          description: ISO 8601 timestamp of last update
          format: date-time
          example: 2024-01-15T10:30:00Z
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: An error occurred
  securitySchemes:
    default:
      type: oauth2
      flows:
        implicit:
          authorizationUrl: https://test.com
          scopes:
            ordinary: ordinary
            privilaged: privilaged
          x-scopes-bindings:
            privilaged: privilaged
            ordinary: ordinary
x-wso2-api-key-header: ApiKey
x-wso2-auth-header: Authorization
x-wso2-cors:
  corsConfigurationEnabled: false
  accessControlAllowOrigins:
   - '*'
  accessControlAllowCredentials: false
  accessControlAllowHeaders:
   - authorization
   - Access-Control-Allow-Origin
   - Content-Type
   - SOAPAction
  accessControlAllowMethods:
   - GET
   - PUT
   - POST
   - DELETE
   - PATCH
   - OPTIONS
x-wso2-production-endpoints:
  urls:
   - http://mock-backends.ballerina.svc.cluster.local:9092/oas/
  type: http
x-wso2-sandbox-endpoints:
  urls:
   - http://mock-backends.ballerina.svc.cluster.local:9092/oas/
  type: http
x-wso2-basePath: /oasserviceapi/1.0.0
x-wso2-transports:
 - https
x-wso2-application-security:
  security-types:
   - api_key
   - oauth2
  optional: false
x-wso2-response-cache:
  enabled: true
  cacheTimeoutInSeconds: 300
